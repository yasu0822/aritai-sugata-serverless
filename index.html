
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ありたい姿探究アプリ</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f1419 100%);
            min-height: 100vh;
            font-family: 'Hiragino Sans', 'Yu Gothic', 'Meiryo', sans-serif;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .gold-accent {
            color: #d4af37;
        }
        
        .gold-border {
            border-color: #d4af37;
        }
        
        .btn-gold {
            background: linear-gradient(135deg, #d4af37 0%, #ffd700 100%);
            color: #1a1a2e;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn-gold:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(212, 175, 55, 0.4);
        }
        
        .input-field {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            color: white;
            transition: all 0.3s ease;
        }
        
        .input-field:focus {
            border-color: #d4af37;
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
            outline: none;
            background: rgba(255, 255, 255, 0.15);
        }
        
        .char-counter {
            font-size: 0.8rem;
            color: #d4af37;
        }
        
        .char-counter.over-limit {
            color: #ff6b6b;
        }
        
        .result-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 16px;
            padding: 2rem;
            margin-top: 2rem;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(212, 175, 55, 0.3);
            border-radius: 50%;
            border-top-color: #d4af37;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .error-message {
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid rgba(255, 107, 107, 0.3);
            border-radius: 8px;
            padding: 1rem;
            color: #ff6b6b;
            margin-top: 1rem;
        }
    </style>
</head>
<body class="text-white">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- ヘッダー -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold gold-accent mb-4">
                <i class="fas fa-compass mr-3"></i>
                ありたい姿探究アプリ
            </h1>
            <p class="text-gray-300 text-lg">あなただけの未来への道筋を発見しましょう</p>
        </div>

        <!-- アクセスコード入力 -->
        <div id="accessCodeSection" class="glass-card p-8 mb-8">
            <h2 class="text-2xl font-semibold gold-accent mb-6 text-center">
                <i class="fas fa-key mr-2"></i>
                アクセスコード
            </h2>
            <div class="max-w-md mx-auto">
                <input 
                    type="text" 
                    id="accessCodeInput" 
                    placeholder="イベント専用コードを入力してください"
                    class="input-field w-full px-4 py-3 text-center tracking-wider"
                    maxlength="20"
                >
                <button 
                    onclick="checkAccessCode()" 
                    class="btn-gold w-full mt-4 py-3 rounded-lg font-semibold"
                >
                    <i class="fas fa-unlock mr-2"></i>
                    認証
                </button>
                <div id="accessCodeError" class="error-message hidden">
                    正しいアクセスコードを入力してください
                </div>
            </div>
        </div>

        <!-- メインアプリ -->
        <div id="mainApp" class="hidden">
            <!-- ワード入力セクション -->
            <div class="glass-card p-8 mb-8">
                <h2 class="text-2xl font-semibold gold-accent mb-6 text-center">
                    <i class="fas fa-pen-fancy mr-2"></i>
                    ワード・文章を入力してください
                </h2>
                <div class="text-gray-300 mb-4 text-center">
                    <p>改行で区切って入力してください（最大20個まで）</p>
                    <p class="text-sm mt-2">1行あたり100文字まで</p>
                </div>
                
                <div class="relative">
                    <textarea 
                        id="wordsInput" 
                        placeholder="例：&#10;リーダーシップを発揮したい&#10;創造的なアイデアを大切にする&#10;チームメンバーと協力する&#10;新しいことに挑戦する勇気"
                        class="input-field w-full px-4 py-4 h-48 resize-none"
                        oninput="updateCharCount()"
                    ></textarea>
                    <div class="flex justify-between items-center mt-2">
                        <div id="lineCount" class="char-counter">0行</div>
                        <div id="charCount" class="char-counter">各行の文字数をチェック中...</div>
                    </div>
                </div>
                
                <button 
                    onclick="analyzeWords()" 
                    id="analyzeBtn"
                    class="btn-gold w-full mt-6 py-4 rounded-lg text-lg font-semibold disabled:opacity-50 disabled:cursor-not-allowed"
                >
                    <i class="fas fa-magic mr-2"></i>
                    ありたい姿を発見する
                </button>
                
                <div id="inputError" class="error-message hidden"></div>
            </div>

            <!-- 結果表示セクション -->
            <div id="resultsSection" class="hidden">
                <div class="result-card fade-in">
                    <h2 class="text-2xl font-semibold gold-accent mb-6 text-center">
                        <i class="fas fa-star mr-2"></i>
                        あなたの分析結果
                    </h2>
                    
                    <div id="visionResult" class="mb-8">
                        <h3 class="text-xl font-semibold gold-accent mb-4">
                            <i class="fas fa-lightbulb mr-2"></i>
                            ありたい姿
                        </h3>
                        <div id="visionContent" class="text-gray-100 leading-relaxed"></div>
                    </div>
                    
                    <div id="actionsResult">
                        <h3 class="text-xl font-semibold gold-accent mb-4">
                            <i class="fas fa-tasks mr-2"></i>
                            行動案
                        </h3>
                        <div id="actionsContent" class="text-gray-100 leading-relaxed"></div>
                    </div>
                    
                    <button 
                        onclick="resetApp()" 
                        class="btn-gold w-full mt-8 py-3 rounded-lg font-semibold"
                    >
                        <i class="fas fa-redo mr-2"></i>
                        新しい分析を始める
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentAccessCode = '';

        function checkAccessCode() {
            const input = document.getElementById('accessCodeInput');
            const code = input.value.trim();
            const errorDiv = document.getElementById('accessCodeError');
            
            const validCodes = ['VISION2025JUL'];
            
            if (validCodes.includes(code)) {
                currentAccessCode = code;
                document.getElementById('accessCodeSection').style.display = 'none';
                document.getElementById('mainApp').classList.remove('hidden');
                errorDiv.classList.add('hidden');
            } else {
                errorDiv.classList.remove('hidden');
                input.focus();
            }
        }

        function updateCharCount() {
            const textarea = document.getElementById('wordsInput');
            const lines = textarea.value.split('\n').filter(line => line.trim() !== '');
            const lineCountDiv = document.getElementById('lineCount');
            const charCountDiv = document.getElementById('charCount');
            
            lineCountDiv.textContent = `${lines.length}行`;
            
            let overLimitLines = 0;
            let maxChars = 0;
            
            lines.forEach(line => {
                if (line.length > 100) {
                    overLimitLines++;
                }
                maxChars = Math.max(maxChars, line.length);
            });
            
            if (overLimitLines > 0) {
                charCountDiv.textContent = `${overLimitLines}行が100文字を超えています`;
                charCountDiv.classList.add('over-limit');
            } else if (lines.length > 0) {
                charCountDiv.textContent = `最長行: ${maxChars}文字`;
                charCountDiv.classList.remove('over-limit');
            } else {
                charCountDiv.textContent = '各行の文字数をチェック中...';
                charCountDiv.classList.remove('over-limit');
            }
            
            // 20行制限チェック
            if (lines.length > 20) {
                lineCountDiv.classList.add('over-limit');
            } else {
                lineCountDiv.classList.remove('over-limit');
            }
        }

        async function analyzeWords() {
            const textarea = document.getElementById('wordsInput');
            const words = textarea.value.trim();
            const btn = document.getElementById('analyzeBtn');
            const errorDiv = document.getElementById('inputError');
            
            // 入力検証
            if (!words) {
                showError('ワードまたは文章を入力してください', 'inputError');
                return;
            }
            
            const lines = words.split('\n').filter(line => line.trim() !== '');
            if (lines.length > 20) {
                showError('入力は20行以内にしてください', 'inputError');
                return;
            }
            
            const overLimitLines = lines.filter(line => line.length > 100);
            if (overLimitLines.length > 0) {
                showError('各行は100文字以内にしてください', 'inputError');
                return;
            }
            
            // エラーメッセージをクリア
            errorDiv.classList.add('hidden');
            
            // ローディング状態
            btn.disabled = true;
            btn.innerHTML = '<div class="loading mr-2"></div>分析中...';
            
            try {
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        words: words,
                        accessCode: currentAccessCode
                    })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || `サーバーエラー: ${response.status}`);
                }
                
                displayResults(data.result);
                
            } catch (error) {
                console.error('分析エラー:', error);
                let errorMessage = '分析中にエラーが発生しました。';
                
                if (error.message.includes('Failed to fetch')) {
                    errorMessage = 'サーバーとの通信に失敗しました。インターネット接続を確認してください。';
                } else if (error.message.includes('Invalid access code')) {
                    errorMessage = 'アクセスコードが無効です。';
                } else if (error.message.includes('Server configuration error')) {
                    errorMessage = 'サーバー設定エラーです。管理者にお問い合わせください。';
                } else if (error.message) {
                    errorMessage = `エラー: ${error.message}`;
                }
                
                showError(errorMessage, 'inputError');
            } finally {
                // ボタンを元に戻す
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-magic mr-2"></i>ありたい姿を発見する';
            }
        }

        function displayResults(resultText) {
            // 結果を解析
            const lines = resultText.split('\n').filter(line => line.trim() !== '');
            
            let visionTitle = '';
            let visionDescription = '';
            let actions = [];
            
            let currentSection = '';
            let visionLines = [];
            
            for (let line of lines) {
                if (line.includes('ありたい姿：') || line.includes('ありたい姿:')) {
                    currentSection = 'vision';
                    visionTitle = line.replace(/ありたい姿[：:]\s*/, '').trim();
                } else if (line.includes('解説：') || line.includes('解説:')) {
                    currentSection = 'description';
                } else if (line.includes('行動案：') || line.includes('行動案:')) {
                    currentSection = 'actions';
                } else if (line.match(/^\d+\./)) {
                    if (currentSection === 'actions') {
                        actions.push(line.trim());
                    }
                } else if (currentSection === 'vision' && line.trim()) {
                    visionLines.push(line.trim());
                } else if (currentSection === 'description' && line.trim()) {
                    visionDescription += line.trim() + ' ';
                }
            }
            
            // ありたい姿の説明が複数行の場合
            if (visionLines.length > 0 && !visionDescription) {
                visionDescription = visionLines.join(' ');
            }
            
            // 結果を表示
            const visionContent = document.getElementById('visionContent');
            const actionsContent = document.getElementById('actionsContent');
            
            visionContent.innerHTML = `
                <div class="mb-4">
                    <h4 class="text-lg font-semibold gold-accent mb-2">${visionTitle}</h4>
                    <p class="text-gray-200 leading-relaxed">${visionDescription.trim()}</p>
                </div>
            `;
            
            actionsContent.innerHTML = actions.map((action, index) => `
                <div class="mb-3 p-3 bg-gray-800 bg-opacity-30 rounded-lg">
                    <span class="gold-accent font-semibold">${index + 1}. </span>
                    <span class="text-gray-200">${action.replace(/^\d+\.\s*/, '')}</span>
                </div>
            `).join('');
            
            // 結果セクションを表示
            document.getElementById('resultsSection').classList.remove('hidden');
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
        }

        function showError(message, elementId) {
            const errorDiv = document.getElementById(elementId);
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
        }

        function resetApp() {
            document.getElementById('wordsInput').value = '';
            document.getElementById('resultsSection').classList.add('hidden');
            document.getElementById('inputError').classList.add('hidden');
            updateCharCount();
            document.getElementById('wordsInput').focus();
        }

        // Enter キーでアクセスコード認証
        document.getElementById('accessCodeInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkAccessCode();
            }
        });

        // 初期化
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('accessCodeInput').focus();
            updateCharCount();
        });
    </script>
</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDruImqMtgsQQSUqniO9r45YYRj3GH5onam4xThOx%2BeiB2dgvTgOdSLVZOZlBWxVhJHhMXVELNznoTzublgpcRvjNgtiv1Kib36hEmNguagVoCJQ6g2XCxs3sLeI2dli1%2F92KEf%2FJ%2BlVVZqd2RCxAFQzZO8oFpq7PdZRaqXo0FiWFRMIQ8v62KADnmsKca8yusROY7s3TSsuKhB1%2FlVMWKJxlt8th4BxStOS0vv771Ine9D3Jz1OGM452zbEJ%2BmIJH9%2FbLRg2G9NdWr2B7Rxee9c6NiCq4gcGQJEvA8x9MKBRz0uatOzSBhTGSlum9D3hhOVE2FTcL83ZumUEoIxTTpQTbAjsyyzatw3Yq%2FXQ%2FLEYzMZLb0PH04kCBKWoV2DJMoBnKVO5jD7Kn47Lo3Cdg8Fbmwh%2BGKfCwnbCjwK%2FsvyoGho5XwTWx%2FboMv9e43sLdJE4XTiXAYBVOPV9EokkQT4U9wPFXyCGEVgsT8JgpCkYSH1tYRkVpvOm6nGN5x136OcDlD%2FP3iMIOIa%2B66mjJ3derzZqonUBCIJA1b2gwtz9";
        window.__genspark_locale = "ja-JP";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDruImqMtgsQQSUqniO9r45YYRj3GH5onam4xThOx+eiB2dgvTgOdSLVZOZlBWxVhJHhMXVELNznoTzublgpcRvjNgtiv1Kib36hEmNguagVoCJQ6g2XCxs3sLeI2dli1/92KEf/J+lVVZqd2RCxAFQzZO8oFpq7PdZRaqXo0FiWFRMIQ8v62KADnmsKca8yusROY7s3TSsuKhB1/lVMWKJxlt8th4BxStOS0vv771Ine9D3Jz1OGM452zbEJ+mIJH9/bLRg2G9NdWr2B7Rxee9c6NiCq4gcGQJEvA8x9MKBRz0uatOzSBhTGSlum9D3hhOVE2FTcL83ZumUEoIxTTpQTbAjsyyzatw3Yq/XQ/LEYzMZLb0PH04kCBKWoV2DJMoBnKVO5jD7Kn47Lo3Cdg8Fbmwh+GKfCwnbCjwK/svyoGho5XwTWx/boMv9e43sLdJE4XTiXAYBVOPV9EokkQT4U9wPFXyCGEVgsT8JgpCkYSH1tYRkVpvOm6nGN5x136OcDlD/P3iMIOIa+66mjJ3derzZqonUBCIJA1b2gwtz9";
    </script>
    
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
    
