
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ありたい姿探究アプリ</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            font-family: 'Hiragino Sans', 'Yu Gothic', sans-serif;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .gold-accent {
            color: #d4af37;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #d4af37, #f4d03f);
            transition: all 0.3s ease;
            color: #1a1a2e;
            font-weight: bold;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(212, 175, 55, 0.4);
        }
        
        .input-field {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            transition: all 0.3s ease;
        }
        
        .input-field:focus {
            background: rgba(255, 255, 255, 0.15);
            border-color: #d4af37;
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
        }
        
        .input-field::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid #d4af37;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .char-counter {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.6);
        }
        
        .char-counter.warning {
            color: #f39c12;
        }
        
        .char-counter.error {
            color: #e74c3c;
        }
        
        .result-card {
            background: rgba(255, 255, 255, 0.08);
            border-left: 4px solid #d4af37;
            animation: fadeInUp 0.6s ease-out;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .vision-title {
            background: linear-gradient(45deg, #d4af37, #f4d03f);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: bold;
            font-size: 1.2rem;
        }
    </style>
</head>
<body class="flex items-center justify-center p-4">
    <div class="w-full max-w-2xl">
        <!-- アクセスコード入力画面 -->
        <div id="accessCodeScreen" class="glass-card rounded-2xl p-8">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-white mb-2">
                    <i class="fas fa-compass gold-accent mr-3"></i>
                    ありたい姿探究アプリ
                </h1>
                <p class="text-gray-300">あなただけのワクワクする未来を発見しよう</p>
            </div>
            
            <div class="space-y-6">
                <div>
                    <label class="block text-white text-sm font-medium mb-2">
                        <i class="fas fa-key gold-accent mr-2"></i>
                        イベント参加者専用コード
                    </label>
                    <input 
                        type="password" 
                        id="accessCodeInput" 
                        class="input-field w-full px-4 py-3 rounded-lg focus:outline-none"
                        placeholder="アクセスコードを入力してください"
                    >
                </div>
                
                <button 
                    onclick="checkAccessCode()" 
                    class="btn-primary w-full py-3 px-6 rounded-lg"
                >
                    <i class="fas fa-unlock mr-2"></i>
                    アプリを開始する
                </button>
            </div>
        </div>

        <!-- メイン画面 -->
        <div id="mainScreen" class="hidden">
            <!-- ヘッダー -->
            <div class="glass-card rounded-2xl p-6 mb-6">
                <div class="text-center">
                    <h1 class="text-2xl font-bold text-white mb-2">
                        <i class="fas fa-compass gold-accent mr-3"></i>
                        ありたい姿探究アプリ
                    </h1>
                    <p class="text-gray-300">ワードや文章からあなただけの未来を描き出します</p>
                </div>
            </div>

            <!-- 入力フォーム -->
            <div class="glass-card rounded-2xl p-6 mb-6">
                <div class="space-y-4">
                    <div>
                        <label class="block text-white text-sm font-medium mb-2">
                            <i class="fas fa-edit gold-accent mr-2"></i>
                            ワードや文章を入力してください（1行100文字まで）
                        </label>
                        <textarea 
                            id="wordsInput" 
                            class="input-field w-full px-4 py-3 rounded-lg focus:outline-none resize-none"
                            rows="8"
                            placeholder="例：&#10;リーダーシップを発揮したい&#10;チームメンバーを大切にする&#10;新しいことに挑戦する勇気&#10;&#10;※改行で区切って入力してください"
                        ></textarea>
                        <div id="charCounter" class="char-counter mt-2 text-right">
                            入力された行数: 0行
                        </div>
                    </div>
                    
                    <button 
                        onclick="analyzeVision()" 
                        id="analyzeBtn"
                        class="btn-primary w-full py-3 px-6 rounded-lg"
                    >
                        <i class="fas fa-magic mr-2"></i>
                        ありたい姿を発見する
                    </button>
                </div>
            </div>

            <!-- ローディング -->
            <div id="loadingScreen" class="hidden glass-card rounded-2xl p-8">
                <div class="text-center">
                    <div class="loading-spinner mx-auto mb-4"></div>
                    <p class="text-white text-lg mb-2">AIがあなたの未来を分析中...</p>
                    <p class="text-gray-300 text-sm">素敵な発見をお待ちください</p>
                </div>
            </div>

            <!-- 結果表示 -->
            <div id="resultScreen" class="hidden">
                <!-- ありたい姿 -->
                <div class="result-card glass-card rounded-2xl p-6 mb-6">
                    <h2 class="text-xl font-bold text-white mb-4">
                        <i class="fas fa-star gold-accent mr-2"></i>
                        あなたのありたい姿
                    </h2>
                    <div class="space-y-4">
                        <div>
                            <h3 class="vision-title mb-2" id="visionTitle"></h3>
                            <p class="text-gray-200 leading-relaxed" id="visionDescription"></p>
                        </div>
                    </div>
                </div>

                <!-- 行動案 -->
                <div class="result-card glass-card rounded-2xl p-6 mb-6">
                    <h2 class="text-xl font-bold text-white mb-4">
                        <i class="fas fa-route gold-accent mr-2"></i>
                        具体的な行動案
                    </h2>
                    <div class="space-y-4" id="actionsList">
                        <!-- 行動案がここに挿入されます -->
                    </div>
                </div>

                <!-- 再分析ボタン -->
                <div class="text-center">
                    <button 
                        onclick="resetApp()" 
                        class="btn-primary py-3 px-8 rounded-lg"
                    >
                        <i class="fas fa-redo mr-2"></i>
                        新しいワードで分析する
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // アクセスコード設定（イベントごとに変更）
        const validCodes = ['VISION2025JUL'];
        
        // 文字数カウンター
        document.getElementById('wordsInput').addEventListener('input', function() {
            const lines = this.value.split('\n').filter(line => line.trim() !== '');
            const counter = document.getElementById('charCounter');
            
            let hasLongLine = false;
            lines.forEach(line => {
                if (line.length > 100) {
                    hasLongLine = true;
                }
            });
            
            counter.textContent = `入力された行数: ${lines.length}行`;
            
            if (hasLongLine) {
                counter.className = 'char-counter mt-2 text-right error';
                counter.textContent += ' (100文字を超える行があります)';
            } else if (lines.length > 20) {
                counter.className = 'char-counter mt-2 text-right warning';
                counter.textContent += ' (20行を超えています)';
            } else {
                counter.className = 'char-counter mt-2 text-right';
            }
        });

        // アクセスコードチェック
        function checkAccessCode() {
            const userCode = document.getElementById('accessCodeInput').value;
            
            if (validCodes.includes(userCode)) {
                document.getElementById('accessCodeScreen').style.display = 'none';
                document.getElementById('mainScreen').classList.remove('hidden');
            } else {
                alert('正しいアクセスコードを入力してください。');
            }
        }

        // Enterキーでアクセスコード確認
        document.getElementById('accessCodeInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkAccessCode();
            }
        });

        // 分析実行
        async function analyzeVision() {
            const wordsInput = document.getElementById('wordsInput').value.trim();
            
            if (!wordsInput) {
                alert('ワードや文章を入力してください。');
                return;
            }

            const lines = wordsInput.split('\n').filter(line => line.trim() !== '');
            
            // 文字数・行数チェック
            let hasLongLine = false;
            lines.forEach(line => {
                if (line.length > 100) {
                    hasLongLine = true;
                }
            });

            if (hasLongLine) {
                alert('各行は100文字以内で入力してください。');
                return;
            }

            if (lines.length > 20) {
                alert('入力は20行以内でお願いします。');
                return;
            }

            // UI状態変更
            document.getElementById('analyzeBtn').disabled = true;
            document.getElementById('loadingScreen').classList.remove('hidden');
            document.getElementById('resultScreen').classList.add('hidden');

            try {
                // サーバーレス関数に送信
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        words: lines
                    })
                });

                if (!response.ok) {
                    throw new Error('分析中にエラーが発生しました。');
                }

                const result = await response.json();
                displayResult(result);

            } catch (error) {
                console.error('Error:', error);
                alert('分析中にエラーが発生しました。時間をおいて再度お試しください。');
            } finally {
                document.getElementById('analyzeBtn').disabled = false;
                document.getElementById('loadingScreen').classList.add('hidden');
            }
        }

        // 結果表示
        function displayResult(result) {
            // ありたい姿表示
            document.getElementById('visionTitle').textContent = result.vision.title;
            document.getElementById('visionDescription').textContent = result.vision.description;

            // 行動案表示
            const actionsList = document.getElementById('actionsList');
            actionsList.innerHTML = '';
            
            result.actions.forEach((action, index) => {
                const actionDiv = document.createElement('div');
                actionDiv.className = 'bg-white bg-opacity-5 p-4 rounded-lg';
                actionDiv.innerHTML = `
                    <div class="flex items-start">
                        <div class="bg-gradient-to-r from-yellow-400 to-yellow-600 text-gray-900 rounded-full w-8 h-8 flex items-center justify-center font-bold text-sm mr-4 flex-shrink-0 mt-1">
                            ${index + 1}
                        </div>
                        <p class="text-gray-200 leading-relaxed">${action}</p>
                    </div>
                `;
                actionsList.appendChild(actionDiv);
            });

            document.getElementById('resultScreen').classList.remove('hidden');
        }

        // アプリリセット
        function resetApp() {
            document.getElementById('wordsInput').value = '';
            document.getElementById('charCounter').textContent = '入力された行数: 0行';
            document.getElementById('charCounter').className = 'char-counter mt-2 text-right';
            document.getElementById('resultScreen').classList.add('hidden');
            document.getElementById('wordsInput').focus();
        }
    </script>

    <!-- 
    注意: このHTMLファイルは Vercel Functions と組み合わせて使用します。
    
    必要なVercel Function (/api/analyze.js):
    
    export default async function handler(req, res) {
        if (req.method !== 'POST') {
            return res.status(405).json({ error: 'Method not allowed' });
        }

        const { words } = req.body;
        const API_KEY = process.env.OPENAI_API_KEY; // 環境変数から取得

        try {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${API_KEY}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    model: 'gpt-3.5-turbo',
                    messages: [{
                        role: 'user',
                        content: `あなたは百戦錬磨のメンターです。以下のワード・文章から、その人だけのオーダーメイドな分析を行い、ワクワクする未来を提案してください。

入力されたワード・文章：
${words.join('\n')}

以下のJSON形式で出力してください：
{
  "vision": {
    "title": "15-25文字の魅力的な表現",
    "description": "100-150文字の具体的で感情豊かな描写"
  },
  "actions": [
    "時期・方法・頻度を含む超具体的な行動1",
    "時期・方法・頻度を含む超具体的な行動2",
    "時期・方法・頻度を含む超具体的な行動3"
  ]
}`
                    }],
                    temperature: 0.8
                })
            });

            const data = await response.json();
            const result = JSON.parse(data.choices[0].message.content);
            
            res.status(200).json(result);
        } catch (error) {
            res.status(500).json({ error: 'Analysis failed' });
        }
    }

    環境変数設定 (.env):
    OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxx
    -->
</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDlZ5ZjvfKXGqLR7ykA1t%2FfcJ836j2A8avEBE5zLye4WNiOPczrSrUG%2FB0fATsF3KaGaCb45johYXHVOFpwe%2BOmU2ptgu9UPbJXM%2B0Z9BcU%2BkzYLc97pc6bCk9KV%2FFzZg4TQxfGUfR3FazdQelvJ4F4Q1Kj6yKmr%2BHiWDQEGFgNTAk0mYbkw6vJTqz5fAvu4GOdeZBW%2BOeaUvG9eIhXzzSW%2BZDP%2FHsuiRCjnyIGSO%2F9PQVgca9coNx8cfDMl43jvjRlDwbT8OyztKzcTanW8BwUt%2FIoHG9Ip%2Fe4XT18HibSYIm3k2M3KeZQc5fsB1hFsF6%2F2hsTSp7TJIHZ0uG9J9QzE90sV3Yk1kAUzHDmPQ6z2dJGUUbug7aKI%2BsdRDWn1cR%2Fazat7rP%2FRK0wJquSDg7alJZWuFul3Eqt19oo7yv8T5Bm7AO15uwdrgO69SJorE%2B3x%2FrpLFMUTButQCFdywnrcTOAzCWxfcy3DJKNaL2BYgYh5AIMmHUwaGULRTdRcwYy2r3XDIElMUC2sp7gg7xOM%3D";
        window.__genspark_locale = "ja-JP";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDlZ5ZjvfKXGqLR7ykA1t/fcJ836j2A8avEBE5zLye4WNiOPczrSrUG/B0fATsF3KaGaCb45johYXHVOFpwe+OmU2ptgu9UPbJXM+0Z9BcU+kzYLc97pc6bCk9KV/FzZg4TQxfGUfR3FazdQelvJ4F4Q1Kj6yKmr+HiWDQEGFgNTAk0mYbkw6vJTqz5fAvu4GOdeZBW+OeaUvG9eIhXzzSW+ZDP/HsuiRCjnyIGSO/9PQVgca9coNx8cfDMl43jvjRlDwbT8OyztKzcTanW8BwUt/IoHG9Ip/e4XT18HibSYIm3k2M3KeZQc5fsB1hFsF6/2hsTSp7TJIHZ0uG9J9QzE90sV3Yk1kAUzHDmPQ6z2dJGUUbug7aKI+sdRDWn1cR/azat7rP/RK0wJquSDg7alJZWuFul3Eqt19oo7yv8T5Bm7AO15uwdrgO69SJorE+3x/rpLFMUTButQCFdywnrcTOAzCWxfcy3DJKNaL2BYgYh5AIMmHUwaGULRTdRcwYy2r3XDIElMUC2sp7gg7xOM=";
    </script>
    
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
    