
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ありたい姿探究アプリ</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 50%, #3b82f6 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .gold-accent {
            color: #d4af37;
        }
        
        .gold-border {
            border-color: #d4af37;
        }
        
        .gold-bg {
            background-color: #d4af37;
        }
        
        .char-counter {
            font-size: 0.75rem;
            color: #d1d5db;
        }
        
        .char-counter.warning {
            color: #fbbf24;
        }
        
        .char-counter.error {
            color: #ef4444;
        }
        
        .result-section {
            display: none;
        }
        
        .loading {
            display: none;
        }
        
        .vision-title {
            color: #d4af37;
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }
        
        .vision-content {
            color: #f3f4f6;
            line-height: 1.6;
            margin-bottom: 1rem;
        }
        
        .action-item {
            background: rgba(255, 255, 255, 0.05);
            border-left: 3px solid #d4af37;
            padding: 1rem;
            margin-bottom: 0.75rem;
            border-radius: 0 8px 8px 0;
        }
    </style>
</head>
<body class="flex items-center justify-center p-4">
    <div class="w-full max-w-2xl">
        <div class="glass-card rounded-2xl p-8 text-white">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold gold-accent mb-2">
                    <i class="fas fa-compass mr-3"></i>ありたい姿探究アプリ
                </h1>
                <p class="text-gray-300">あなただけの理想の未来を発見しましょう</p>
            </div>

            <!-- アクセスコード入力 -->
            <div id="accessCodeSection" class="mb-6">
                <label class="block text-sm font-medium mb-2">
                    <i class="fas fa-key mr-2 gold-accent"></i>アクセスコード
                </label>
                <div class="flex gap-3">
                    <input type="text" id="accessCode" 
                           class="flex-1 px-4 py-3 bg-white bg-opacity-20 border border-white border-opacity-30 rounded-lg text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-yellow-400"
                           placeholder="イベント参加者専用コードを入力">
                    <button onclick="verifyAccessCode()" 
                            class="gold-bg text-gray-900 px-6 py-3 rounded-lg font-medium hover:bg-yellow-500 transition-colors">
                        認証
                    </button>
                </div>
                <div id="accessError" class="text-red-400 text-sm mt-2 hidden">
                    <i class="fas fa-exclamation-triangle mr-1"></i>正しいアクセスコードを入力してください
                </div>
            </div>

            <!-- メイン入力フォーム -->
            <div id="mainForm" class="hidden">
                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2">
                        <i class="fas fa-pencil-alt mr-2 gold-accent"></i>あなたのワード・文章
                    </label>
                    <p class="text-gray-300 text-sm mb-3">
                        ありたい姿の要素となるワードや文章を、改行で区切って入力してください（1行100文字まで、最大20行）
                    </p>
                    <div class="relative">
                        <textarea id="wordsInput" 
                                  class="w-full h-40 px-4 py-3 bg-white bg-opacity-20 border border-white border-opacity-30 rounded-lg text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-yellow-400 resize-none"
                                  placeholder="例：&#10;リーダーシップを発揮したい&#10;チームメンバーを大切にする&#10;新しいことに挑戦する勇気&#10;継続的に学び続ける姿勢"
                                  oninput="updateCharCounter()"></textarea>
                        <div id="charCounter" class="char-counter absolute bottom-2 right-3">
                            0行 / 20行
                        </div>
                    </div>
                </div>

                <button onclick="analyzeWords()" id="analyzeBtn"
                        class="w-full gold-bg text-gray-900 py-4 rounded-lg font-medium text-lg hover:bg-yellow-500 transition-all duration-300 transform hover:scale-105">
                    <i class="fas fa-magic mr-2"></i>ありたい姿を探究する
                </button>

                <!-- ローディング -->
                <div id="loading" class="loading text-center py-8">
                    <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-yellow-400 mb-4"></div>
                    <p class="text-gray-300">
                        <i class="fas fa-search mr-2"></i>あなただけの理想の姿を分析中...
                    </p>
                </div>

                <!-- 結果表示 -->
                <div id="resultSection" class="result-section mt-8">
                    <div class="glass-card rounded-xl p-6 mb-6">
                        <h2 class="text-xl font-bold gold-accent mb-4">
                            <i class="fas fa-star mr-2"></i>あなたのありたい姿
                        </h2>
                        <div id="visionResult" class="space-y-4">
                            <!-- 結果がここに表示されます -->
                        </div>
                    </div>

                    <div class="glass-card rounded-xl p-6">
                        <h2 class="text-xl font-bold gold-accent mb-4">
                            <i class="fas fa-tasks mr-2"></i>具体的な行動案
                        </h2>
                        <div id="actionResult" class="space-y-3">
                            <!-- 行動案がここに表示されます -->
                        </div>
                    </div>

                    <button onclick="resetForm()" 
                            class="w-full mt-6 bg-white bg-opacity-20 text-white py-3 rounded-lg font-medium hover:bg-opacity-30 transition-colors">
                        <i class="fas fa-redo mr-2"></i>もう一度探究する
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let isAuthenticated = false;

        function verifyAccessCode() {
            const code = document.getElementById('accessCode').value.trim();
            const errorDiv = document.getElementById('accessError');
            
            if (code === 'VISION2025JUL') {
                isAuthenticated = true;
                document.getElementById('accessCodeSection').style.display = 'none';
                document.getElementById('mainForm').classList.remove('hidden');
                errorDiv.classList.add('hidden');
            } else {
                errorDiv.classList.remove('hidden');
            }
        }

        function updateCharCounter() {
            const textarea = document.getElementById('wordsInput');
            const counter = document.getElementById('charCounter');
            const lines = textarea.value.split('\n');
            const lineCount = lines.length;
            
            // 各行の文字数チェック
            let hasLongLine = false;
            for (let line of lines) {
                if (line.length > 100) {
                    hasLongLine = true;
                    break;
                }
            }
            
            counter.textContent = `${lineCount}行 / 20行`;
            
            if (lineCount > 20 || hasLongLine) {
                counter.className = 'char-counter error';
            } else if (lineCount > 15) {
                counter.className = 'char-counter warning';
            } else {
                counter.className = 'char-counter';
            }
        }

        async function analyzeWords() {
            if (!isAuthenticated) {
                alert('アクセスコードを入力してください。');
                return;
            }

            const words = document.getElementById('wordsInput').value.trim();
            if (!words) {
                alert('ワード・文章を入力してください。');
                return;
            }

            const lines = words.split('\n');
            if (lines.length > 20) {
                alert('入力は20行以内にしてください。');
                return;
            }

            for (let line of lines) {
                if (line.length > 100) {
                    alert('各行は100文字以内にしてください。');
                    return;
                }
            }

            // UI更新
            document.getElementById('analyzeBtn').style.display = 'none';
            document.getElementById('loading').style.display = 'block';
            document.getElementById('resultSection').style.display = 'none';

            try {
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        words: words,
                        accessCode: 'VISION2025JUL'
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'Analysis failed');
                }

                displayResults(data.result);

            } catch (error) {
                console.error('Error:', error);
                alert('分析中にエラーが発生しました。時間をおいて再度お試しください。');
            } finally {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('analyzeBtn').style.display = 'block';
            }
        }

        function displayResults(result) {
            const visionDiv = document.getElementById('visionResult');
            const actionDiv = document.getElementById('actionResult');
            
            // 結果をパースして表示
            const lines = result.split('\n').filter(line => line.trim());
            
            let visionTitle = '';
            let visionDescription = '';
            let actions = [];
            
            let currentSection = '';
            
            for (let line of lines) {
                line = line.trim();
                if (line.includes('ありたい姿：') || line.includes('ありたい姿:')) {
                    visionTitle = line.replace(/ありたい姿[：:]\s*/, '');
                    currentSection = 'vision';
                } else if (line.includes('解説：') || line.includes('解説:')) {
                    visionDescription = line.replace(/解説[：:]\s*/, '');
                } else if (line.includes('行動案：') || line.includes('行動案:')) {
                    currentSection = 'action';
                } else if (line.match(/^\d+[\.\)]/)) {
                    actions.push(line.replace(/^\d+[\.\)]\s*/, ''));
                } else if (currentSection === 'vision' && !visionDescription && line) {
                    visionDescription = line;
                } else if (currentSection === 'action' && line && !line.match(/^\d+[\.\)]/)) {
                    if (actions.length > 0) {
                        actions[actions.length - 1] += ' ' + line;
                    }
                }
            }
            
            // ありたい姿の表示
            visionDiv.innerHTML = `
                <div class="vision-title">${visionTitle}</div>
                <div class="vision-content">${visionDescription}</div>
            `;
            
            // 行動案の表示
            actionDiv.innerHTML = actions.map((action, index) => `
                <div class="action-item">
                    <div class="flex items-start">
                        <span class="gold-accent font-bold mr-3">${index + 1}.</span>
                        <div class="text-gray-100">${action}</div>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('resultSection').style.display = 'block';
            
            // 結果にスクロール
            document.getElementById('resultSection').scrollIntoView({ 
                behavior: 'smooth' 
            });
        }

        function resetForm() {
            document.getElementById('wordsInput').value = '';
            document.getElementById('resultSection').style.display = 'none';
            updateCharCounter();
            
            // フォームの先頭にスクロール
            document.getElementById('mainForm').scrollIntoView({ 
                behavior: 'smooth' 
            });
        }

        // Enter キーでアクセスコード認証
        document.getElementById('accessCode').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                verifyAccessCode();
            }
        });
    </script>
</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDggtKPec91MGwSRUL3I8gKpCOadUfRlVBC34Rzz23YcSR4X9%2FL5CZo%2FoBXcn8OhkMtKKK4saWkY9CJUaI%2BE8V3SsN%2BlIV6b%2FBJ317JknLeDH92y228XOu5x07fowVPdUtARDu15EN1oGUPUbtxGP0MUaUbDPf7o%2BkP9lLX3tV8zZ%2BP3ZWRjLKk6EqiNXybl7beZsaCK21uiL%2Bd3exK1HQrhLIDHQc6xIHo1AVNLlGNDWykwV2JDepiSA1ap7disnMV9fNhoc4g0BqlGhXUubU21wuYMQjY4X%2F7rWV77%2F%2FCoPw1JS4uBNef0nlmdElj%2FAwa4KTYH2frrZ8Do9OvZB%2BE9fhKQHYJHK6jtKphWWMHB1dQD6FYGp4TV3Ms3x86KhBr%2BI9F92%2Fkfu1pQhlWU7smC5yWwVZT9lTX%2BAmBIFtirzHGyaQcHtQSslDl%2FseebG1ifWyK6%2FgKbkfllv%2ByMQLuCL35%2FY%2Bw2hkjrADQl8KTWTaPd9sTracweAgwHPRIQS%2FLjcG0h26z7W74fJ%2FdUsmac%3D";
        window.__genspark_locale = "ja-JP";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDggtKPec91MGwSRUL3I8gKpCOadUfRlVBC34Rzz23YcSR4X9/L5CZo/oBXcn8OhkMtKKK4saWkY9CJUaI+E8V3SsN+lIV6b/BJ317JknLeDH92y228XOu5x07fowVPdUtARDu15EN1oGUPUbtxGP0MUaUbDPf7o+kP9lLX3tV8zZ+P3ZWRjLKk6EqiNXybl7beZsaCK21uiL+d3exK1HQrhLIDHQc6xIHo1AVNLlGNDWykwV2JDepiSA1ap7disnMV9fNhoc4g0BqlGhXUubU21wuYMQjY4X/7rWV77//CoPw1JS4uBNef0nlmdElj/Awa4KTYH2frrZ8Do9OvZB+E9fhKQHYJHK6jtKphWWMHB1dQD6FYGp4TV3Ms3x86KhBr+I9F92/kfu1pQhlWU7smC5yWwVZT9lTX+AmBIFtirzHGyaQcHtQSslDl/seebG1ifWyK6/gKbkfllv+yMQLuCL35/Y+w2hkjrADQl8KTWTaPd9sTracweAgwHPRIQS/LjcG0h26z7W74fJ/dUsmac=";
    </script>
    
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
    
